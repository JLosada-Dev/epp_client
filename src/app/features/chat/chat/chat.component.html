<div
  class="flex flex-col h-full w-full bg-gradient-to-t from-purple-50/70 to-white rounded-2xl shadow-inner border border-gray-100 p-4 sm:p-6 box-border"
>
  <div
    class="flex-1 overflow-y-auto space-y-3 min-h-[200px]"
    id="chat-messages"
  >
    <div
      *ngFor="let m of log"
      class="flex"
      [ngClass]="{
        'justify-end': m.role === 'user',
        'justify-start': m.role === 'bot',
        'justify-center': m.role === 'system',
      }"
    >
      <span
        class="inline-block max-w-full sm:max-w-md md:max-w-lg px-4 py-2 rounded-2xl break-words text-sm sm:text-base shadow"
        [ngClass]="{
          'bg-purple-600 text-white rounded-br-none': m.role === 'user',
          'bg-white text-gray-900 border border-purple-100 rounded-bl-none':
            m.role === 'bot',
          'bg-gray-100 text-gray-700 text-xs italic border border-gray-200':
            m.role === 'system',
        }"
      >
        {{ m.text }}
      </span>
    </div>

    <!-- Indicador de carga -->
    <div *ngIf="isLoading" class="flex justify-start">
      <span
        class="inline-block px-4 py-2 rounded-2xl bg-white border border-purple-100 text-purple-600"
      >
        <div class="flex space-x-1">
          <div class="w-2 h-2 bg-purple-600 rounded-full animate-bounce"></div>
          <div
            class="w-2 h-2 bg-purple-600 rounded-full animate-bounce"
            style="animation-delay: 0.2s"
          ></div>
          <div
            class="w-2 h-2 bg-purple-600 rounded-full animate-bounce"
            style="animation-delay: 0.4s"
          ></div>
        </div>
      </span>
    </div>
  </div>

  <form
    class="flex gap-2 pt-4 border-t border-gray-100 w-full"
    (ngSubmit)="send()"
  >
    <input
      [(ngModel)]="msg"
      name="msg"
      autocomplete="off"
      placeholder="Pregunta sobre EPPâ€¦"
      class="flex-1 min-w-0 border border-gray-200 rounded-lg p-2 focus:outline-none focus:ring-2 focus:ring-purple-300 transition text-sm sm:text-base bg-white"
      [disabled]="isLoading"
    />
    <button
      type="submit"
      class="px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg font-semibold transition"
      [disabled]="isLoading || !msg.trim()"
      [ngClass]="{ 'opacity-50 cursor-not-allowed': isLoading || !msg.trim() }"
    >
      Enviar
    </button>
  </form>

  <!-- Indicador de elementos faltantes -->
  <div
    *ngIf="missing && missing.length > 0"
    class="mt-3 px-3 py-2 bg-amber-50 border border-amber-200 rounded-lg text-xs"
  >
    <p class="font-medium text-amber-700">
      EPP faltante: {{ missing.join(', ') }}
    </p>
  </div>
</div>
